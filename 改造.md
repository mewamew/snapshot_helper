# Mac 兼容性改造记录

## 改造目标
让 snapshot_helper 截屏工具兼容 macOS 系统。

---

## 已完成的改造

### 1. 热键支持
- Mac 使用 `Ctrl+A` 触发截图
- Windows 保持 `Shift+Alt+B`
- 托盘菜单和提示文字根据平台动态显示

### 2. 系统托盘图标
- Mac 使用 22x22 小图标（适配菜单栏）
- Windows 保持 32x32

### 3. 高 DPI 屏幕适配
- 设置 pixmap 的 `devicePixelRatio` 让 Qt 自动处理缩放
- Mac 上使用 `screen.grabWindow()` 替代 mss 截图
- 添加 DPR 校准逻辑处理 macOS 缩放模式

### 4. mss 坐标系统兼容
- Mac 上 mss.monitors 返回逻辑像素坐标
- 调整匹配逻辑使用逻辑像素

### 5. Mac 启动脚本
- `run_mac.command` - 双击启动
- `com.snaptool.plist` - LaunchAgent 开机自启配置
- `install_launchagent.sh` - 安装脚本

---

## 待实施的改造

### 6. 隐藏 Dock 图标

**问题：** 程序运行时在 Dock 显示 Python 火箭图标，不美观。

**方案：** 设置应用为"后台应用"模式（Accessory App），只显示菜单栏图标。

**代码位置：** `snap_tool.py` 的 `main()` 函数，在创建 QApplication 之前添加：

```python
if sys.platform == 'darwin':
    from AppKit import NSApplication, NSApplicationActivationPolicyAccessory
    NSApplication.sharedApplication().setActivationPolicy_(NSApplicationActivationPolicyAccessory)
```

**依赖：** pyobjc-framework-Cocoa（已作为 pynput 依赖安装，无需额外安装）

**效果：**
- 不在 Dock 显示图标
- 只在顶部菜单栏显示托盘图标
- 程序仍可正常运行和交互

---

## 文件变更清单

| 文件 | 状态 | 说明 |
|------|------|------|
| `snap_tool.py` | 已修改 | 主程序 Mac 兼容性改造 |
| `run_mac.command` | 已新建 | Mac 启动脚本 |
| `com.snaptool.plist` | 已新建 | LaunchAgent 配置 |
| `install_launchagent.sh` | 已新建 | 自启安装脚本 |
| `改造.md` | 已新建 | 改造记录文档 |
